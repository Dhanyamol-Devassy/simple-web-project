<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fetch Data</title>
    <style>
        /* Define styles for the table */
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            padding: 8px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        th {
            background-color: gray
        }
        tr:nth-child(even) {
            background-color: lightblue  
        }
        tr:nth-child(odd) {
            background-color: lightseagreen
        }
    </style>
</head>
<body>
    <h1>Country Data</h1>
    <div id="countryData"></div>

    <script>
        // Fetch data from the API endpoint
        fetch('http://localhost:3000/alldata')
            .then(response => response.json())
            .then(data => {
                // Process and display data
                const countryData = document.getElementById('countryData');
                countryData.innerHTML = '<h2>All Country Data</h2>';
                data.country.forEach(async country => {
                    const countryDiv = document.createElement('div');
                    countryDiv.innerHTML = `<h2>${country.name}</h2>`;
                    // Create a table for each country
                    const table = document.createElement('table');
                    // Create table header
                    const thead = document.createElement('thead');
                    const headerRow = document.createElement('tr');
                    ['Capital', 'Unemployment', 'Total GDP', 'Holidays'].forEach(headerText => {
                        const th = document.createElement('th');
                        th.textContent = headerText;
                        headerRow.appendChild(th);
                    });
                    thead.appendChild(headerRow);
                    table.appendChild(thead);
                    // Create table body
                    const tbody = document.createElement('tbody');
                    const row = document.createElement('tr');
                    const cellCapital = document.createElement('td');
                    cellCapital.textContent = country['@capital'] ? country['@capital'].split('-').pop() : 'N/A';
                    row.appendChild(cellCapital);
                    const cellUnemployment = document.createElement('td');
                    cellUnemployment.textContent = country.unemployment;
                    row.appendChild(cellUnemployment);
                    const cellGDP = document.createElement('td');
                    cellGDP.textContent = country.gdp_total;
                    row.appendChild(cellGDP);
                    // Fetch holiday data for the current country
                    try {
                        const response = await fetch(`http://localhost:3000/country/${country.name}/holidays`);
                        const holidayData = await response.json();
                        const cellHolidays = document.createElement('td');
                        cellHolidays.textContent = holidayData.map(holiday => holiday.name).join(', ');
                        row.appendChild(cellHolidays);
                    } catch (error) {
                        console.error('Error fetching holidays for', country.name, ':', error);
                        const cellHolidays = document.createElement('td');
                        cellHolidays.textContent = 'N/A';
                        row.appendChild(cellHolidays);
                    }
                    tbody.appendChild(row);
                    table.appendChild(tbody);
                    countryDiv.appendChild(table);
                    countryData.appendChild(countryDiv);
                });
            })
            .catch(error => console.error('Error fetching data:', error));
    </script>
</body>
</html>
